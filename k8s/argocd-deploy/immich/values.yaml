immich:
  image:
    tag: v1.132.3

  immich:
    persistence:
      library:
        existingClaim: immich-store-pvc

  redis:
    enabled: true

  server:
    env:
      - name: DB_HOSTNAME
        value: immich-rw

      - name: DB_DATABASE_NAME
        value: immich

      - name: DB_USERNAME
        valueFrom:
          secretKeyRef:
            name: immich-superuser
            key: username

      - name: DB_PASSWORD
        valueFrom:
          secretKeyRef:
            name: immich-superuser
            key: password

      # these are SUPPOSED to be autogenerated by the chart, but because of the
      # secrets above the lib template for deployments clobbers everything OMG
      - name: IMMICH_MACHINE_LEARNING_URL
        value: http://immich-machine-learning:3003
      - name: REDIS_HOSTNAME
        value: immich-redis-master
    ingress:
      main:
        enabled: true
        ingressClassName: nginx
        annotations:
          cert-manager.io/cluster-issuer: duckdns-letsencrypt-prod
          nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
          nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
          nginx.ingress.kubernetes.io/ssl-passthrough: "true"
        hosts:
          - host: immich.rannet.duckdns.org
            paths:
              - path: "/"
        tls:
          - hosts:
            - immich.rannet.duckdns.org
            secretName: immich-cert
