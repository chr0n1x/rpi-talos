vault-auth:
  vaultConnectionName: vault-secrets-operator/default
  authMethods:
    - name: on-prem
      vaultAuthName: homepage-vso-connection-auth
      method: kubernetes
      mount: in-cluster
      config:
        role: homepage
        serviceAccount: homepage
        audiences:
          - vault

# uses vso config above to generate secret refs
widgetConfigs:
  - name: argocd
    path: homepage/widgets/argocd
  - name: immich
    path: homepage/widgets/immich
  - name: jellyfin
    path: homepage/widgets/jellyfin
  - name: filebrowser
    path: homepage/widgets/filebrowser
  - name: paperless-ngx
    path: homepage/widgets/paperless-ngx
  - name: pihole
    path: homepage/widgets/pihole
  - name: gitea
    path: homepage/widgets/gitea

homepage:
  # required for above
  serviceAccount:
    create: true
    name: homepage

  # reloader operator in separate NS; restarts deployment when cfg map updates
  podAnnotations:
    configmap.reloader.stakater.com/reload: "homepage-cm"

  # match name up with manifest + name above
  config:
    useExistingConfigMap: homepage-cm

  image:
    repository: ghcr.io/gethomepage/homepage
    tag: latest
  env:
    - name: HOMEPAGE_ALLOWED_HOSTS
      value: "home.k8s:30443,home.k8s:30080,rannet.duckdns.org"
    - name: HOMEPAGE_VAR_ARGOCD_KEY
      valueFrom:
        secretKeyRef:
          name: argocd-widget-secrets
          key: api_key
    - name: HOMEPAGE_VAR_IMMICH_KEY
      valueFrom:
        secretKeyRef:
          name: immich-widget-secrets
          key: api_key
    - name: HOMEPAGE_VAR_JELLYFIN_KEY
      valueFrom:
        secretKeyRef:
          name: jellyfin-widget-secrets
          key: api_key
    - name: HOMEPAGE_VAR_PAPERLESSNGX_KEY
      valueFrom:
        secretKeyRef:
          name: paperless-ngx-widget-secrets
          key: api_key
    - name: HOMEPAGE_VAR_FILEBROWSER_USERNAME
      valueFrom:
        secretKeyRef:
          name: filebrowser-widget-secrets
          key: username
    - name: HOMEPAGE_VAR_FILEBROWSER_PASSWORD
      valueFrom:
        secretKeyRef:
          name: filebrowser-widget-secrets
          key: password
    - name: HOMEPAGE_VAR_PIHOLE_KEY
      valueFrom:
        secretKeyRef:
          name: pihole-widget-secrets
          key: api_key
    - name: HOMEPAGE_VAR_GITEA_API_KEY
      valueFrom:
        secretKeyRef:
          name: gitea-widget-secrets
          key: pat

  extraClusterRoles:
    - apiGroups:
        - ""
      resources:
        - namespaces
        - pods
        - nodes
      verbs:
        - get
        - list
    - apiGroups:
        - extensions
        - networking.k8s.io
      resources:
        - ingresses
      verbs:
        - get
        - list
    - apiGroups:
        - traefik.containo.us
      resources:
        - ingressroutes
      verbs:
        - get
        - list
    - apiGroups:
        - metrics.k8s.io
      resources:
        - nodes
        - pods
      verbs:
        - get
        - list


  # using traefik ingressroute
  ingress:
    main:
      enabled: false
