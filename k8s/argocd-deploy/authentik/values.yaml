cnpg:
  image: ghcr.io/tensorchord/cloudnative-vectorchord:17-0.4.3
  roleName: authentik
  labels: {}
  annotations: {}

# TODO: eh?
# valkey:

global:
  namespaceOverride: authentik
  # to prevent Role name clash w/ other CRDs?
  fullnameOverride: authentik-app

  env:
    - name: AUTHENTIK_POSTGRESQL__HOST 
      value: authentik-rw

    - name: AUTHENTIK_POSTGRESQL__SSLMODE
      value: prefer

    - name: AUTHENTIK_POSTGRESQL__NAME
      value: authentik

    - name: AUTHENTIK_POSTGRESQL__USER
      valueFrom:
        secretKeyRef:
          name: authentik-superuser
          key: username

    - name: AUTHENTIK_POSTGRESQL__PASSWORD
      valueFrom:
        secretKeyRef:
          name: authentik-superuser
          key: password

    - name: AUTHENTIK_SECRET_KEY
      valueFrom:
        secretKeyRef:
          name: authentik-superuser
          key: password

    - name: AUTHENTIK_REDIS__HOST
      value: authentik-valkey

    - name: AUTHENTIK_REDIS__PORT
      value: "6379"

authentik:
  error_reporting:
    enabled: true

  server:
    resources:
      requests:
        cpu: 250m
        memory: 2G
      limits:
        cpu: 750m
        memory: 4G

    ingress:
      enabled: true
      ingressClassName: nginx
      annotations:
        cert-manager.io/cluster-issuer: duckdns-letsencrypt-prod
        nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
        nginx.ingress.kubernetes.io/force-ssl-redirect: "false"
        nginx.ingress.kubernetes.io/ssl-passthrough: "true"
      tls:
        - hosts:
          - authentik.rannet.duckdns.org
          secretName: authentik-cert
      hosts:
        - authentik.rannet.duckdns.org

  # death to bitnami
  # using cnpg and valkey here instead
  postgresql:
      enabled: false
  redis:
      enabled: false
