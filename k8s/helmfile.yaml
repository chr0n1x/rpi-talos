repositories:
  - name: prometheus
    url: https://prometheus-community.github.io/helm-charts

  - name: k8s-dashboard
    url: https://kubernetes.github.io/dashboard/

  - name: longhorn
    url: https://charts.longhorn.io

  - name: grafana
    url: https://grafana.github.io/helm-charts

  - name: prometheus
    url: https://prometheus-community.github.io/helm-charts

  - name: descheduler
    url: https://kubernetes-sigs.github.io/descheduler/

  - name: homepage
    url: https://jameswynn.github.io/helm-charts

releases:
  # for more info on default installation:
  #   https://github.com/kubernetes-sigs/descheduler/blob/master/charts/descheduler/README.md
  - name: descheduler
    namespace: kube-system
    chart: descheduler/descheduler

  - name: prometheus
    namespace: monitoring
    createNamespace: true
    chart: prometheus/prometheus
    version: ~v25.23.0

  - name: grafana
    chart: grafana/grafana
    version: ~8.3.2
    namespace: monitoring
    createNamespace: true
    needs:
      - monitoring/prometheus
    values:
      # this just started to fail one day, no idea
      - initChownData:
          enabled: false
      - persistence:
          enabled: true
          storageClassName: longhorn
          # TODO: somehow find-or-create longhorn pvc?
          # existingClaim: grafana-pvc
          accessModes:
            - ReadWriteMany
      - datasources:
          datasources.yaml:
            apiVersion: 1
            datasources:
            - name: Prometheus
              type: prometheus
              url: http://prometheus-server

  - name: longhorn
    namespace: longhorn-system
    createNamespace: true
    chart: longhorn/longhorn
    version: ~1.6.2

  - name: kubernetes-dashboard
    namespace: kubernetes-dashboard
    createNamespace: true
    chart: k8s-dashboard/kubernetes-dashboard
    version: ~7.5.0

  - name: homepage
    namespace: homepage
    chart: kustomize/homepage
    createNamespace: true
    # TODO: restart deployment if config-map updated?

  - name: ingress-nginx
    namespace: ingress-nginx
    chart: kustomize/nginx
    hooks:
      - events:
          - cleanup
        command: kubectl
        args:
          - apply
          - --recursive
          - -f
          - manifests/post-install-configurations
