repositories:
  - name: prometheus
    url: https://prometheus-community.github.io/helm-charts

  - name: k8s-dashboard
    url: https://kubernetes.github.io/dashboard/

  - name: longhorn
    url: https://charts.longhorn.io

  - name: grafana
    url: https://grafana.github.io/helm-charts

  - name: prometheus
    url: https://prometheus-community.github.io/helm-charts

  - name: homarr-oci
    url: ghcr.io/oben01/charts
    oci: true

  - name: descheduler
    url: https://kubernetes-sigs.github.io/descheduler/

releases:
  # for more info on default installation:
  #   https://github.com/kubernetes-sigs/descheduler/blob/master/charts/descheduler/README.md
  - name: descheduler
    namespace: kube-system
    chart: descheduler/descheduler

  - name: prometheus
    namespace: monitoring
    createNamespace: true
    chart: prometheus/prometheus
    version: ~v25.23.0
    set:
    - name: rbac.create
      value: false

  - name: grafana
    chart: grafana/grafana
    version: ~8.3.2
    namespace: monitoring
    createNamespace: true
    needs:
      - monitoring/prometheus
    values:
      - persistence:
          enabled: true
          storageClassName: longhorn
          # TODO: somehow find-or-create longhorn pvc?
          # existingClaim: grafana-pvc
      - datasources:
          datasources.yaml:
            apiVersion: 1
            datasources:
            - name: Prometheus
              type: prometheus
              url: http://prometheus-server

  - name: longhorn
    namespace: longhorn-system
    createNamespace: true
    chart: longhorn/longhorn
    version: ~1.6.2

  - name: kubernetes-dashboard
    namespace: kubernetes-dashboard
    createNamespace: true
    chart: k8s-dashboard/kubernetes-dashboard
    version: ~7.5.0

  - name: homarr
    namespace: homarr
    createNamespace: true
    chart: homarr-oci/homarr
    version: ~1.2.5
    values:
      - env:
          TZ: America/New York
      - ingress:
          enabled: true
          ingressClassName: nginx
          hosts:
            - host: home.k8s
              paths:
                - path: /
                  pathType: Prefix

  - name: ingress-nginx
    namespace: ingress-nginx
    chart: kustomize/nginx
    hooks:
      - events:
          - cleanup
        command: kubectl
        args:
          - apply
          - --recursive
          - -f
          - manifests
